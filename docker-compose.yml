version: '2'

networks:
    factorytx-net:
        driver: bridge

volumes:
    postgres-data-volume:
        external: true

services:
    factorytx:
        container_name: factorytx
        hostname: factorytx
        image: sightmachine/factorytx
        networks:
            - factorytx-net
        build:
            context: /opt/sightmachine/factorytx
            dockerfile: Dockerfile
        tty: true
        depends_on:
            - postgres
        volumes:
            - ./FactoryTx/pipelines/conf.d/:/opt/sightmachine/FactoryTx/FactoryTx/pipelines/conf.d/
            - ./databuffer/:/var/spool/sightmachine/FactoryTx/
            - ./:/opt/sightmachine/FactoryTx/
            - /var/log/sightmachine/factorytx/:/var/log/sightmachine/factorytx/

    postgres:
        container_name: postgres
        hostname: postgres
        image: sightmachine/postgres
        networks:
            - factorytx-net
        volumes:
            - postgres-data-volume:/var/lib/postgresql/data
            - /opt/sightmachine/dumps:/opt/sightmachine/dumps
        ports:
            - "5432:5432"
