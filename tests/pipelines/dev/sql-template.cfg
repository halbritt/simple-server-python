pipeline:
- dataplugins:
  - type: sql
    name: SQL Plugin
    config:
      version: 1.0.0
      host: 'postgres'
      port: 5432
      poll_rate: 10
      cachedirectory: '/tmp/'
      cachefilename: "CLIENT_ATE.json"
      cache: {last_id: '01-Jan-2000#'}
      db_type: 'postgresql+psycopg2'
      db_user: 'postgres'
      db_pass: 'postgres'
      db_name: 'client'
      sslog_type: cycle
      limit: 0
      records_per_file: 750
     # ssl: False
      datasources:
        - name: CLIENT_ModuleATE_1
          config:
            query:
              SELECT ps937_moduledata.ate_testdate AS timestamp, ARRAY[ps937_siliconbatchdata.ate_siliconbatchnumber1::text, ps937_moduledata.ATE_BatchNumber] AS batch_no, *
              FROM ps937_moduledata
              LEFT JOIN ps937_modulebatchdata ON ps937_moduledata.ate_batchnumber = ps937_modulebatchdata.ate_batchnumber
              LEFT JOIN ps937_moduletestboxdata ON ps937_moduledata.ate_batchnumber = ps937_moduletestboxdata.ate_batchnumber
              LEFT JOIN ps937_siliconbatchdata ON ps937_modulebatchdata.ate_siliconbatchnumberreference = ps937_siliconbatchdata.ate_siliconbatchnumberreference
            filter: ps937_moduledata.ate_testdate = ps937_modulebatchdata.ate_testdate AND ps937_moduledata.ate_batchnumber != '1log' AND ps937_moduledata.ate_batchnumber != '2log' AND ps937_moduledata.ate_batchnumber != '3log'
            time_field_name: ps937_moduledata.ate_testdate
            id_field: ps937_moduledata.ate_testdate
- transforms:
  - type: sslogtransform
    name: Client Transform
    config:
      datasources:
        - name: CLIENT_SiliconProbingV2_1
      version: 1.0.0
      poll_rate: 1
      counter: True
      actions:
        - rename:
            columns:
              "SiP_WaferID": batch_no
        - set_index: ['SiP_Date']
      stractions:
        - column: SiP_PartType
          function: strip
        - column: batch_no
          function: strip
        - column: SiP_WaferNo
          function: strip
        - column: SiP_PartNo
          function: strip
  - type: sslogtransform
    name: Mod Transform
    config:
      version: 1.0.0
      datasources:
        - name: CLIENT_ModuleATE_1
      actions:
        - set_index: ['0']
- tx:
  - type: remotedatapost
    name: remote data post
    version: 1.0.0
    config:
      datasources:
        - name: CLIENT_SiliconProbingV2_1
      version: 1.0.0
      output_name: 'cs-mrslim-dev'  # XXX
      apikey: 'JDYkcm91bmRzPTEwMDAwMCRNNlZBaG9yZ3BPVVYuQ0lGJFVxdnY0cnpuT2hwQUV5Qk9WUHpxNC5hRTYxckIzWlFXbTBRekovM3AwNER5Q2QwQ3lSbmk4ajV4bUx3eXJmbGwwdy4wcGNDUm8xWHlVSDBSQnl0c1Iw'
      tenantname: cs  # XXX
      apikeyid: 'rdpv2@cs.sightmachine.com'
      sitedomain: 'mrslim-dev'
      protocol: 'http'
      username: ''
      password: ''
      use_encryption: True
